<!--<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css">-->
<!--<script src="http://code.jquery.com/jquery-1.9.1.js"></script>
<script src="http://code.jquery.com/ui/1.10.4/jquery-ui.js"></script>-->
<script type="text/javascript">
    $(document).ready(function(){
        $('.btn_avaliar').click(function(){
            id = $(this).attr('idPronac');
            window.open("<?php echo $this->url(array('controller' => 'cidadao', 'action' => 'cadastrar-opiniao'), null, true); ?>?idPronac="+id,"_blank");
        });

        $('.btn_ver').click(function(){
            id = $(this).attr('idPronac');
            window.open("<?php echo $this->url(array('controller' => 'cidadao', 'action' => 'visualizar-opinioes'), null, true); ?>?idPronac="+id,"_blank");
        });

        $('.btn_imprimir').click(function(){
            $('#pesquisa').attr('action', '<?php echo $this->url(array('controller' => 'cidadao', 'action' => 'imprimir-listagem')); echo $this->urlComplement; ?>');
            $('#pesquisa').submit();
        });

        $('.btn_xls').click(function(){
	    $('#pesquisa').attr('action', '<?php echo $this->url(array('controller' => 'cidadao', 'action' => 'xls-listagem')); echo $this->urlComplement; ?>');
	    $("#pesquisa").submit();
        });

        $('.tooltip').click(function(){
            $('#pesquisa').attr('action', '<?php echo $this->url(array('controller' => 'cidadao', 'action' => 'imprimir-listagem')); ?>');
            return false;
        });

        // Pedro - Funï¿½ï¿½o da mascara de CPF/CNPJ
	function cpf() {
            document.getElementById('CnpjCpfConsulta').maxLength = "14";
            document.getElementById('CnpjCpfConsulta').onkeyup   = function() { mascara(document.forms.pesquisa.CnpjCpfConsulta, format_cpf); };
            document.getElementById('CnpjCpfConsulta').focus();
	}
	function cnpj() {
            document.getElementById('CnpjCpfConsulta').maxLength = "18";
            document.getElementById('CnpjCpfConsulta').onkeyup   = function() { mascara(document.forms.pesquisa.CnpjCpfConsulta, format_cnpj); };
            document.getElementById('CnpjCpfConsulta').focus();
	}

	$("#CnpjCpfConsulta").keypress(function(event){
            if ($("#CnpjCpfConsulta").val().length < 14) {
		cpf();
            } else {
		cnpj();
            }
	});
	//FIM - PEDRO

	// Fernao
	$(".tabela input").keypress(function(event) {
            if (event.which == 13) {
		$('#pesquisa').attr('action', '<?php echo $this->url(array('controller' => 'cidadao', 'action' => 'consultar')); ?>');
		$("#pesquisa").submit();
            }
	});
	$(".btn_recarregar").click(function(){
	    $('#pesquisa').attr('action', '<?php echo $this->url(array('controller' => 'cidadao', 'action' => 'consultar')); ?>');
            $("#pesquisa").submit();
	});

	//Alysson - Inicio
	$(".btn_pesquisar").click(function(){
	    $('#pesquisa').attr('action', '<?php echo $this->url(array('controller' => 'cidadao', 'action' => 'consultar')); ?>');
            $("#pesquisa").submit();
	});	//Alysson - Fim
    });
</script>

<style type="text/css">
    .tooltip{
        display: inline;
        position: relative;
    }

    .tooltip:hover:after{
        background: #ddd;
        border-radius: 5px;
        border: 1px solid #ccc;
        bottom: 26px;
        color: #333;
        content: attr(title);
        left: 20%;
        padding: 10px 15px;
        position: absolute;
        z-index: 98;
        width: 320px;
        font-size: 14px;
        line-height: 1.5em;
    }

    .tooltip:hover:before{
        border: solid;
        border-color: #ddd transparent;
        border-width: 6px 6px 0 6px;
        bottom: 20px;
        content: "";
        left: 50%;
        position: absolute;
        z-index: 99;
    }

    .faleconosco{
        color: #35953F !important;
        font-size: 20px;
        text-decoration: underline !important;
    }
    #NrPronacConsulta{
      width: 60px;
    }

    #NomeProjetoConsulta{
      width: 200px;
    }

    #CnpjCpfConsulta{
      width: 155px;
    }

    #ProponenteConsulta{
      width: 180px;
    }

    #idNrReuniaoConsulta{
      width: 50px;
    }
 
    #pag{
      width: 50px;
    }

    #qtde{
      width: 50px;
    }

    .input_simples{
      width: 110px;
    }

    table td{
      padding: 4px;
    }

</style>

<?php if($this->intranet){ $intranet = '&intranet'; } else { $intranet = ''; } ?>

<div id="alerta" class="sumir"></div>

<!-- ========== INICIO BREADCRUMB (LINKS TOPO) ========== -->
<div id="breadcrumb">
    <ul>
        <li class="first"><a href="<?php echo $this->url(array('controller' => 'principal', 'action' => '')); ?>" title="Ir para Inï¿½cio">Início</a></li>
        <li class="last">Lista de Projetos</li>
    </ul>
</div>
<!-- ========== FIM BREADCRUMB (LINKS TOPO) ========== -->


<!-- ========== INICIO TITULO ========== -->
<div id="titulo">
    <div class="direita">
    <?php if (is_object($this->reuniao)) { ?>
    Pauta da CNIC n&ordm; <?php echo $this->reuniao['NrReuniao']; ?> <?php if($this->intranet){ echo ' - Intranet'; } else { if(!$this->usuarioInterno){ echo ' - Vis&atilde;o Cidad&atilde;o'; } } ?>
    <?php } else { ?>

    <?php } ?>
    <a class="faleconosco" href="http://ouvidoria.cultura.gov.br/" target="_blank">Fale Conosco</a>
</div>

<!-- Alysson - Inicio Customizando a Consulta para carregar por Reuniao da CNIC -->
<fieldset>
        <form id="pesquisa" method="post">
          <!-- alinhamento filtro ( Samir ) -->
            <table style="font-size:13px;" class="tabela">
                <tr>
                    <td>
                      <label for="NrPronacConsulta">N&ordm; do PRONAC </label>
                      <input name="NrPronacConsulta" id="NrPronacConsulta" MAXLENGTH=7 class="input_simples" value="<?php echo $this->nrPronac; ?>">
                    </td>
                    <td>
                      <label for="NomeProjetoConsulta">Nome do projeto </label>
                      <input name="NomeProjetoConsulta" id="NomeProjetoConsulta" class="input_simples" value="<?php echo $this->nomeProjeto; ?>">
                    </td>
                    <td>
                      <label for="CpnjCpfConsulta">CPF/CNPJ </label>
                      <input type="text" name="CnpjCpfConsulta" id="CnpjCpfConsulta" class="input_simples" value="<?php echo $this->cnpjCpf; ?>">
                    </td>
                    <td>
                      <label for="ProponenteConsulta">Proponente </label>
        			        <input type="text" name="ProponenteConsulta" id="ProponenteConsulta" class="input_simples" value="<?php echo $this->proponente; ?>">
                    </td>
                    <td>
                      <label for="idNrReuniaoConsulta">N&ordm; da Reuni&atilde;o </label>
		      <select class="input_simples" name="idNrReuniaoConsulta" id="idNrReuniaoConsulta">
			<option value="" selected></option>
			<?php foreach($this->listaReunioes as $u){
			$selected = ($this->idNrReuniaoConsulta == $u->idNrReuniao) ? "selected" : ""; ?>
			<option value="<?php echo $u->idNrReuniao;?>" <?php echo $selected; ?>><?php echo $u->NrReuniao;?></option>
			<?php } ?>
		      </select>
                    </td>
                    <td>
                        <input type="button" name="procurar" class="btn_pesquisar" value=" " /><br>
                    </td>
                </tr>
            </table>
    </fieldset>
<!-- Alysson - Fim Customizando a Consulta para carregar por Reuniao da CNIC -->
</div>
<div id="conteudo" align="center">

    <?php if(count($this->dados)>0){ ?>
    <!-- ============ PAGINACAO ============ -->
    <table class="tabela" style="width: 97%;" border="0" cellpadding="0" cellspacing="0">
        <tbody>
            <tr>
                <td align="center">
                    <?php if($this->paginacao['pag']>1) { ?>
                    <input class="btn_inicio" id="btn_inicio" type="button" class="btn_inicio"
                           onclick="location.href='<?php echo $this->url(array('controller' => 'cidadao', 'action' => 'consultar')).'?pag=1'."&qtde=".$this->paginacao['qtde'].$this->paginacao['ordenacao']; ?>'">
                    <?php } ?>
                    <input id="btn_p_anterior" type="button"
                    <?php if($this->paginacao['pag']<=1) { ?> class="btn_p_anterior-off"
                    <?php }else { ?>
                           class="btn_p_anterior" onclick="location.href='<?php echo $this->url(array('controller' => 'cidadao', 'action' => 'consultar')).'?pag='.($this->paginacao['pag'] - 1)."&qtde=".$this->paginacao['qtde'].$this->paginacao['ordenacao'] . $this->urlComplement; ?>'"
                    <?php } ?>>
                    <input id="btn_p_proximo" type="button"
                           <?php if($this->paginacao['pag']+1 > $this->paginacao['totalPag']) { ?>
                           class="btn_p_proximo-off"
                    <?php }else { ?>
                           class="btn_p_proximo" onclick="location.href='<?php echo $this->url(array('controller' => 'cidadao', 'action' => 'consultar')).'?pag='.($this->paginacao['pag'] + 1)."&qtde=".$this->paginacao['qtde'].$this->paginacao['ordenacao'] . $this->urlComplement; ?>'"
                    <?php } ?>>
                    <?php if($this->paginacao['pag'] < $this->paginacao['totalPag']) { ?>
                    <input class="btn_ultimo" id="btn_ultimo" type="button"
                           onclick="location.href='<?php echo $this->url(array('controller' => 'cidadao', 'action' => 'consultar')).'?pag='.($this->paginacao['totalPag'])."&qtde=".$this->paginacao['qtde'].$this->paginacao['ordenacao'] . $this->urlComplement; ?>'">
                    <?php } ?>
                    P&aacute;g.:<select name="pag" id="pag" onchange="$('#form1').submit()" class="input_simples">
                        <?php for($i=1; $i<=$this->paginacao['totalPag']; $i++):?>
                        <option value="<?php echo $i;?>" <?php if($this->paginacao['pag'] == $i) echo "selected";?>><?php echo $i;?>&nbsp;</option>
                        <?php endfor; ?>
                    </select>
                    &nbsp;Registros por p&aacute;gina:<input type="text" size="1" name="qtde" id="qtde" class="input_simples" value="<?php echo $this->intTamPag;?>"><input type="button" class="btn_recarregar" value="">
                    <input type="hidden" name="campo" value="<?php echo $this->paginacao['campo'];?>">
                    <input type="hidden" name="ordem" value="<?php echo $this->paginacao['ordem'];?>">
<!--                    <input type="hidden" name="tipoFiltro" value="<?php echo $this->filtro;?>">-->
                    <input type="hidden" name="pronac" value="<?php echo $this->pronacProjeto;?>">
                    <input type="button" class="btn_imprimir" title="Imprimir" />
                    <input type="button" class="btn_xls" title="Gerar Excel" />
                 </form>
                </td>
            </tr>
        </tbody>
    </table>
    <center>
        <?php
            echo $this->paginacao['inicio']." a ";
            echo ($this->paginacao['pag']-1)*$this->paginacao['Itenspag'] + $this->paginacao['tamanho'];
            echo " de ". $this->paginacao['total']. " Projetos listados";
        ?>
    </center>
    <!-- ========== FIM PAGINACAO ========== -->
    <?php } ?>

    <?php if(count($this->dados)>0){ ?>
    <table class="tabela tablesorter">
        <thead>
            <tr class="titulo_tabela">
<?php
function parseUrlByOrder($url, $campo, $ordem) {
    // verifica se ja existe um campo ordenado e forca a troca pelo definido
    $url = preg_replace('/(.*)campo=[0-9]{1,2}/', '${1}campo=' . $campo , $url);
    $url = preg_replace('/(.*)ordem=[a-zA-Z]{3,4}/', '${1}ordem=' . $ordem , $url);
    echo $url;

// passar a url composta ja com o url(controller=> etc...)
}
?>
                <th><a href="<?php echo $this->url(array('controller' => 'cidadao', 'action' => 'consultar')) . parseUrlByOrder($this->urlComplement, 1, $this->novaOrdem); ?>">PRONAC</a></th>
                <th><a href="<?php echo $this->url(array('controller' => 'cidadao', 'action' => 'consultar')) . parseUrlByOrder($this->urlComplement, 3, $this->novaOrdem); ?>">Nome do Projeto</a> <br /><span class="red" style="text-transform: none;">Passe o mouse sobre o nome do projeto para ver a s&iacute;ntese</span></th>
                <th><a href="<?php echo $this->url(array('controller' => 'cidadao', 'action' => 'consultar')) . parseUrlByOrder($this->urlComplement, 4, $this->novaOrdem); ?>">Proponente</a></th>
                <th><a href="<?php echo $this->url(array('controller' => 'cidadao', 'action' => 'consultar')) . parseUrlByOrder($this->urlComplement, 5, $this->novaOrdem); ?>">UF</a></th>
                <th><a href="<?php echo $this->url(array('controller' => 'cidadao', 'action' => 'consultar')) . parseUrlByOrder($this->urlComplement, 6, $this->novaOrdem); ?>">Munic&iacute;pio</a></th>
                <th><a href="<?php echo $this->url(array('controller' => 'cidadao', 'action' => 'consultar')) . parseUrlByOrder($this->urlComplement, 7, $this->novaOrdem); ?>">Enquadramento</a></th>
                <th><a href="<?php echo $this->url(array('controller' => 'cidadao', 'action' => 'consultar')) . parseUrlByOrder($this->urlComplement, 8, $this->novaOrdem); ?>">Aacute;rea</a></th>
                <th><a href="<?php echo $this->url(array('controller' => 'cidadao', 'action' => 'consultar')) . parseUrlByOrder($this->urlComplement, 9, $this->novaOrdem); ?>">Segmento</a></th>
                <th><a href="<?php echo $this->url(array('controller' => 'cidadao', 'action' => 'consultar')) . parseUrlByOrder($this->urlComplement, 10, $this->novaOrdem); ?>">Avalia&ccedil;&atilde;o</a></th>
                <th><a href="<?php echo $this->url(array('controller' => 'cidadao', 'action' => 'consultar')) . parseUrlByOrder($this->urlComplement, 11, $this->novaOrdem); ?>">Vl.Solicitado</a></th>
                <th><a href="<?php echo $this->url(array('controller' => 'cidadao', 'action' => 'consultar')) . parseUrlByOrder($this->urlComplement, 12, $this->novaOrdem); ?>">Vl.Aprovado</a></th>
                <th><a href="<?php echo $this->url(array('controller' => 'cidadao', 'action' => 'consultar')) . parseUrlByOrder($this->urlComplement, 13, $this->novaOrdem); ?>">Vl.Captado</a></th>

                <?php /*if(!$this->intranet){ ?>
                <th><?php echo ($this->usuarioInterno) ? 'Opini&otilde;es' : 'Cidad&atilde;o'; ?></th>
                <?php }*/ ?>
            </tr>
        </thead>
        <tbody>
            <?php 
            $TotalSolicitado = 0;
            $TotalAprovado = 0; 
            $TotalCaptado = 0; 
            ?>
            <?php foreach($this->dados as $d){ ?>
            <tr>
                <td align="center" class="w100">
                    <a href="<?php echo $this->url(array('controller' => 'verprojetos', 'action' => 'index'));?>?idPronac=<?php echo Seguranca::encrypt($d->idPronac); ?>" target="_blank">
                        <?php echo $d->Pronac; ?>
                    </a>
                </td>
                <td>
                    <a href="#" title="<?php echo $d->ResumoProjeto; ?>" class="tooltip" style="text-decoration: none;">
                        <span title=" "><?php echo $d->NomeProjeto; ?></span>
                    </a>
                </td>
                <td><?php echo $d->Proponente; ?></td>
                <td><?php echo $d->UF; ?></td>
                <td><?php echo $d->Cidade; ?></td>
                <td><?php echo $d->descEnquadramento; ?></td>
                <td><?php echo $d->dsArea; ?></td>
                <td><?php echo $d->dsSegmento; ?></td>
                <td>
                    <a href="<?php echo $this->url(array('controller' => 'cidadao', 'action' => 'parecer-consolidado'));?>?idPronac=<?php echo Seguranca::encrypt($d->idPronac); ?>" target="_blank"><?php echo $d->descAvaliacao; ?></a>
                </td>
                <td align="right"><?php echo (!empty($d->vlSolicitado)) ? @number_format($d->vlSolicitado, 2, ",", ".") : ''; ?></td>
                <td align="right"><?php echo (!empty($d->vlAprovado)) ? @number_format($d->vlAprovado, 2, ",", ".") : ''; ?></td>
                <td align="right"><?php echo (!empty($d->vlCaptado)) ? @number_format($d->vlCaptado, 2, ",", ".") : ''; ?></td>

            </tr>
            <?php 
            $TotalSolicitado = $TotalSolicitado + $d->vlSolicitado; 
            $TotalAprovado = $TotalAprovado + $d->vlAprovado;
            $TotalCaptado = $TotalCaptado + $d->vlCaptado;
            } ?>
            <tr class="direita bold destacar" style="font-size: 14px;">
                <td colspan="9" style="padding: 15px 5px;">TOTAL</td>
                <td nowrap><?php echo @number_format($TotalSolicitado, 2, ",", "."); ?></td>
                <td nowrap><?php echo @number_format($TotalAprovado, 2, ",", "."); ?></td>
                <td nowrap><?php echo @number_format($TotalCaptado, 2, ",", "."); ?></td>
            </tr>
        </tbody>
    </table>

    <br clear="all" />
    <center>
        <?php echo count($this->dados). " Projetos listados"; ?>
        <input type="button" class="btn_imprimir">
        <input type="button" class="btn_xls" />
    </center>

    <?php } else { ?>
    <table class="tabela">
        <tr>
            <td align="center">Nenhum registro encontrado.</td>
        </tr>
    </table>
    <?php } ?>
    <br clear="all" />
</div>


<!-- ========== INICIO RODAPE DO CONTEUDO ========== -->
<div id="rodapeConteudo"><span></span></div>
<!-- ========== FIM RODAPE DO CONTEUDO ========== -->
<br clear="all" />
