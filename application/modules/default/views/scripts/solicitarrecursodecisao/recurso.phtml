<style type="text/css">
    label {
        font-weight: normal;
        margin-right: 15px;
    }

    .checkObrigatorio {
        margin-right: 5px;
    }
</style>

<?php

$breadcrumb = [
    ['Consultar dados projeto' => $this->url(array('controller' => 'consultardadosprojeto', 'action' => 'index'), '', true) . '?idPronac=' . Seguranca::encrypt($this->escape($this->idPronac))],
    ['Solicitar Recurso da Decis&atilde;o' => '']
];

?>
<div class="container-fluid">
    <?php $this->PageTitle('Solicitar Recurso', $breadcrumb); ?>
    <div id="msgAlerta"></div>
    <div id="conteudo">
        <?php
        if ($this->projeto) : ?>
            <form
                name="formEnviarRecurso"
                id="formEnviarRecurso"
                action="<?php echo $this->url(array('controller' => 'solicitarrecursodecisao', 'action' => 'recurso')); ?>"
                method="post">
                <input type="hidden" name="idPronac" id="idPronac"
                       value="<?php echo $this->escape($this->projeto['idPronac']); ?>"/>
                <table class="tabela">
                    <tr>
                        <td class="destacar bold" style="width: 30%">Pronac</td>
                        <td class="destacar bold">Nome do Projeto</td>
                    </tr>
                    <tr>
                        <td><?= $this->escape($this->projeto['pronac']); ?></td>
                        <td><?= $this->escape($this->projeto['nomeProjeto']); ?></td>
                    </tr>
                    <tr>
                        <td class="destacar bold">Situa&ccedil;&atilde;o</td>
                        <td class="destacar bold">Tipo da Solicita&ccedil;&atilde;o</td>
                    </tr>
                    <tr>
                        <td>
                            <?= $this->projeto['situacao']; ?> - <?= $this->projeto['descricaoSituacao']; ?>
                        </td>
                        <td>
                            <?= $this->projeto['tpSolicitacao'] == 'PI' ? 'Projeto Indeferido' : 'Or&ccedil;amento'; ?>
                        </td>
                    </tr>
                </table>

                <table class="tabela">
                    <tr>
                        <th>Recurso</th>
                    </tr>
                    <tr>
                        <td>
                            <textarea class="textarea_simples dsRecurso" cols="80" id="dsRecurso" name="dsRecurso"
                                      rows="10"></textarea>
                        </td>
                    </tr>
                </table>

                <div style="width: 100%; text-align: center;">
                    <button id="bt_enviar"
                            data-tooltip="Enviar recurso"
                            class="waves-effect waves-dark white-text tooltipped btn btn-primary"
                            type="submit"
                            name="action">
                        Enviar <i class="material-icons right">send</i>
                    </button>

                    <a id="bt_cancelar" class="waves-effect waves-dark white-text tooltipped btn btn-info"
                       data-tooltip="Cancelar envio de recurso" href="javascript:void(0)">
                        <i class="material-icons left">close</i>Cancelar
                    </a>
                </div>
            </form>
        <?php else : ?>
            <table class="tabela">
                <tr>
                    <td class="centro">Nenhum registro encontrado.</td>
                </tr>
            </table>
        <?php endif; ?>
    </div>
</div>


<script type="text/javascript">
    $(document).ready(function () {

        var editorRico = $("#dsRecurso").editorRico({
            altura: 200,
            isLimitarCarateres: true
        });

        // CKEDITOR.replace('dsRecurso', {toolbar: []});

        $("#formEnviarRecurso").validate({
            rules: {
                dsRecurso: {
                    validarPreenchimento: true,
                    validarPreenchimentoMaximo: true
                }
            },
            messages: {
                dsRecurso: {
                    validarPreenchimento: "Texto do Recurso &eacute; obrigat&oacute;rio",
                    validarPreenchimentoMaximo: "Limite excedido"
                }
            },
            submitHandler: function (form) {
                $("#container-loading").show();
                $("#bt_enviar").addClass("disabled");
                form.submit();
            },
            invalidHandler: function (event, validator) {
                Materialize.toast(validator.submitted.dsRecurso, 4000);
            }
        });

        $.validator.addMethod("validarPreenchimento", function (value, element) {
            if (editorRico.contarCaracteres() > 0) {
                return true;
            }
        });
        $.validator.addMethod("validarPreenchimentoMaximo", function (value, element) {
            if (editorRico.contarCaracteres() <= 30000) {
                return true;
            }
        });

        // $('#bt_enviar').click(function () {
//             var dsRecurso = CKEDITOR.instances['dsRecurso'].getData().toString().replace(/(<.*?>)|(&nbsp;)|(\s+)/g, ''),
//                 texto = CKEDITOR.instances['dsRecurso'].getData(),
//                 erro = 0,
//                 countChecks = 0,
//                 msg = 'Favor preencher os dados obrigatórios!';
//
//             if (dsRecurso == '') {
//                 erro++;
//             }
//
// //            if(texto.length > 8000){
// //                erro++;
// //                msg = 'O campo só permite 8.000 caracteres!';
// //            }
//
//             $('.checkObrigatorio').each(function () {
//                 if ($(this).attr('checked')) {
//                     countChecks++;
//                 }
//             });
//
//             if (erro > 0 || countChecks == 0) {
//                 $("#msgAlerta").dialog("destroy");
//                 $("#msgAlerta").html(msg);
//                 $("#msgAlerta").dialog({
//                     resizable: false,
//                     title: 'Alerta!',
//                     width: 300,
//                     height: 160,
//                     modal: true,
//                     buttons: {
//                         'OK': function () {
//                             $(this).dialog('close');
//                         }
//                     }
//                 });
//                 $('.ui-dialog-titlebar-close').remove();
//             } else {
//                 $('#form').submit();
//             }
//         });

        // $('#bt_cancelar').click(function () {
        //     voltar();
        // });
    });
</script>
