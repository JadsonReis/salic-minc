<?php $frmplanoHref = $this->url(array('module' => 'proposta' , 'controller' => 'plano-distribuicao', 'action' => 'frm-plano-distribuicao')).'?idPreProjeto='.$_GET['idPreProjeto']; ?>
<style>
    .gratuito,
    .proponente { background-color: #e6e6e6; text-align: center}
    .popular { background-color: #dcdcdc; text-align: center}
</style>

<div class="container-fluid">
    <div class="row">
        <div class="">
           <div class="row">
               <div class="col s12" id="example">
                    <?php
                    gerarBreadCrumb(array(
                        $this->layout['listagem'],
                        array('Detalhamento do Plano de Distribui&ccedil;&atilde;o' => '')
                    )); ?>

               <div class="row">
                   <div class="col s12 center" >
                        <a class="btn white black-text" href="<?php echo $this->url(array('module' => 'proposta', 'controller'=>'plano-distribuicao','action' => 'index')) ?>">Voltar</a>
                   </div>
               </div>
                <?php $totalExemplares=0; $totalReceita=0; ?>
                    <?php foreach($this->planosDistribuicao as $planoDistribuicao) : ?>
                        <div class="row">
                            <div id="detalhamento-plano" class="col s12">
                                <table class="bordered" >
                                    <thead>
                                        <tr>
                                            <th>Nome do Evento / Produto</th>
                                            <th>&Aacute;rea</th>
                                            <th>Segmento</th>
                                            <th>Principal</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td ><?php echo $planoDistribuicao->Produto; ?></td>
                                            <td ><?php echo $planoDistribuicao->DescricaoArea; ?></td>
                                            <td ><?php echo $planoDistribuicao->DescricaoSegmento; ?></td>
                                            <td ><?php echo ($planoDistribuicao->stPrincipal == 0) ? 'N&atilde;o' : 'Sim'; ?></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <?php foreach($this->abrangencias as $abrangencia): ?>
                            <div class=" col s12 ">
                                <div class="row">
                                    <table class="bordered">
                                        <tbody>
                                        <tr>
                                            <td><?php echo $abrangencia['uf']?> - <?php echo $abrangencia['cidade']?> </td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <my-component
                                                    disabled="<?php echo $this->isEditavel; ?>"
                                                    idplanodistribuicao="<?php echo $planoDistribuicao->idPlanoDistribuicao; ?>"
                                                    idpreprojeto="<?php echo $this->idPreProjeto; ?>"
                                                    iduf="<?php echo $abrangencia['idUF']; ?>"
                                                    idmunicipioibge="<?php echo $abrangencia['idMunicipioIBGE']; ?>"
                                                ></my-component>
                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        <?php endforeach; ?>
                    <?php endforeach ?>
                </div>
            </div>
            <div class="row">
                <div class="col s12 center" >
                        <a class="btn white black-text" href="<?php echo $this->url(array('module' => 'proposta', 'controller'=>'plano-distribuicao','action' => 'index')) ?>">Voltar</a>
                  </div>
               </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="//cdnjs.cloudflare.com/ajax/libs/numeral.js/2.0.4/numeral.min.js"></script>
<script src="https://unpkg.com/vue/dist/vue.js"></script>
<script type="text/x-template" id="app-6">
    <div>
        <div class="row">
            <div class="col s12 center">
               <button class="btn" v-on:click.prevent="mostrar()"><i class="material-icons">{{icon}}</i></button>
           </div>
        </div>
        <div v-show="active">
            <div class="row" >
                <div class="center">
                    <table class="bordered">
                        <thead v-if="produtos.length > 0">
                            <tr>
                                <th rowspan="2">Categoria</th>
                                <th rowspan="2">Quantidade</th>
                                <th class="gratuito" colspan="3">
                                    Distribui&ccedil;&atilde;o Gratuita
                                </th>
                                <th class="popular" colspan="3">
                                    Pre&ccedil;o Popular
                                </th>
                                <th  class="proponente" colspan="3">
                                    Proponente
                                </th>
                                <th rowspan="2">Receita Prevista</th>
                                <th rowspan="2" width="5%">A&ccedil;&otildees</th>
                            </tr>
                            <tr>
                                <th class="gratuito" >Divulga&ccedil;&atilde;o</th>
                                <th class="gratuito" >Patrocinador</th>
                                <th class="gratuito" >Popula&ccedil;&atilde;o</th>
                                <th class="popular">Qtd. Inteira</th>
                                <th class="popular">Qtd. Meia</th>
                                <th class="popular">Pre&ccedil;o Unitario</th>
                                <th class="proponente" >Qtd. Inteira</th>
                                <th class="proponente" >Qtd. Meia</th>
                                <th class="proponente" >Pre&ccedil;o Unitario</th>
                            </tr>
                        </thead>
                        <tbody v-if="produtos.length > 0">
                                <tr  v-for="( produto, index ) in produtos">
                                    <td>{{ produto.dsProduto }}</td>
                                    <td class="center-align">{{ produto.qtExemplares }}</td>
                                    <td class="center-align">{{ produto.qtGratuitaDivulgacao }}</td>
                                    <td class="center-align">{{ produto.qtGratuitaPatrocinador }}</td>
                                    <td class="center-align">{{ produto.qtGratuitaPopulacao }}</td>
                                    <!--Preço Popular -->
                                    <td class="center-align">{{ produto.qtPopularIntegral }}</td>
                                    <td class="center-align">{{ produto.qtPopularParcial }}</td>
                                    <td class="right-align">{{ produto.vlUnitarioPopularIntegral }}</td>
                                    <!--Preço Proponente -->
                                    <td class="center-align">{{ produto.qtProponenteIntegral }}</td>
                                    <td class="center-align">{{ produto.qtProponenteParcial }}</td>
                                    <td class="right-align">{{ produto.vlUnitarioProponenteIntegral }}</td>
                                    <td class="right-align">{{ produto.vlReceitaPrevista }}</td>
                                    <td>
                                        <button class="btn red white-text small" v-bind:disabled="!disabled"
                                            v-on:click="excluir(produto.idDetalhaPlanoDistribuicao)">
                                            <i class="material-icons">delete</i>
                                        </button>
                                    </td>
                                </tr>
                        </tbody>
                        <tbody v-else>
                            <tr>
                                <td colspan="12" class="center-align">Sem dados</td>
                            </tr>
                        </tbody>
                        <tfoot v-if="produtos.length > 0" style="opacity: 0.5">
                            <tr>
                                <td><b>Totais</b></td>
                                <td class="center-align"><b>{{ qtExemplaresTotal }}</b></td>
                                <td class="center-align"><b>{{ qtGratuitaDivulgacaoTotal }}</b></td>
                                <td class="center-align"><b>{{ qtGratuitaPatrocinadorTotal }}</b></td>
                                <td class="center-align"><b>{{ qtGratuitaPopulacaoTotal }}</b></td>
                                <!--Preço Popular -->
                                <td class="center-align"><b>{{ qtPopularIntegralTotal }}</b></td>
                                <td class="center-align"><b>{{ qtPopularParcialTotal }}</b></td>
                                <td class="right-align"> - </td>
                                <!--Fim: Preço Popular -->
                                <td class="center-align"><b>{{ qtProponenteIntegralTotal }}</b></td>
                                <td class="center-align"><b>{{ qtProponenteParcialTotal }}</b></td>
                                <td class="right-align"> - </td>
                                <td class="right-align"><b>{{ receitaPrevistaTotal }}</b></td>
                                <td>  </td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>

            <div id="form-detalhamento" class="card" style="max-width: 1200px; margin: 0 auto; padding: 10px;">
                <form>
                    <div class="row">
                        <h5 class="light center-align">Novo detalhamento</h5>
                        <div class="row">
                            <div class="input-field col s6">
                                <p><b>Tipo de venda</b><br>
                                    <input name="tipoVenda" type="radio" id="tipoVendaIngresso" value="ingresso" v-model="tipoVenda" />
                                    <label for="tipoVendaIngresso">Ingresso</label>
                                    <input name="tipoVenda" type="radio" id="tipoVendaExemplar" value="exemplar" v-model="tipoVenda"/>
                                    <label for="tipoVendaExemplar">Exemplar</label>
                                </p>
                            </div>
                            <div class="input-field col s6">
                                <p><b>Distribui&ccedil;&atilde;o ser&aacute; totalmente gratuita?</b><br>
                                    <input name="group1" type="radio" :id=" _uid + '1' " value="s" v-model="distribuicaoGratuita"/>
                                    <label :for="_uid + '1'">Sim</label>
                                    <input name="group1" type="radio" :id=" _uid + '2' " value="n"  v-model="distribuicaoGratuita"/>
                                    <label :for="_uid + '2'">N&atilde;o</label>
                                </p>
                            </div>
                        </div>

                        <div class="row">
                            <div class="input-field col s6">
                                <p><b>Tipo  do local de apresenta&ccedil;&atilde;o</b><br>
                                    <input name="tipoLocalRealizacao" type="radio" id="tipoAberto" value="aberto" v-model="tipoLocalRealizacao" />
                                    <label for="tipoAberto">Aberto</label>
                                    <input name="tipoLocalRealizacao" type="radio" id="tipoFechado" value="fechado" v-model="tipoLocalRealizacao" />
                                    <label for="tipoFechado">Fechado</label>
                                </p>
                            </div>
                            <div class="input-field col s6">
                                <p><b>Espa&ccedil;o p&uacute;blico</b><br>
                                    <input type="radio" id="espacoPublicoSim" value="s" v-model="espacoPublico"/>
                                    <label for="espacoPublicoSim">Sim</label>
                                    <input type="radio" id="espacoPublicoNao" value="n"  v-model="espacoPublico"/>
                                    <label for="espacoPublicoNao">N&atilde;o</label>
                                </p>
                            </div>
                        </div>
                        <div class="row">
                            <div class="input-field col s6">
                                <input id="dsProduto" type="text" class="validate" placeholder="Ex: Arquibancada" v-model="dsProduto">
                                <label class="active" for="dsProduto">Categoria</label>
                            </div>
                            <div class="input-field col s2">
                                <input id="qtExemplares" type="text" class="validate" placeholder="0" v-model.lazy="qtExemplares">
                                <label class="active" for="qtExemplares">Quantidade</label>
                            </div>
                        </div>

                        <div class="distribuicao-gratuita">
                            <div class="row">
                                <div class="input-field col s12 center-align">
                                    <b>Distribui&ccedil;&atilde;o Gratuita (no minimo 30%)</b>
                                </div>
                            </div>
                            <div class="row">
                                <div class="input-field col s12 m3 l2">
                                    <input id="" class="right-align" v-model.number="qtGratuitaDivulgacao" ref="divulgacao">
                                    <label class="active" for="qtGratuitaDivulgacao">Divulga&ccedil;&atilde;o (At&eacute; {{ (qtExemplares * 0.1) }})</label>
                                </div>
                                <div class="input-field col s12 m3 l2">
                                    <input  class="right-align" v-model="qtGratuitaPatrocinador" ref="patrocinador">
                                    <label class="active" for="qtGratuitaPatrocinador">Patrocinador (At&eacute; {{ (qtExemplares * 0.1) }})</label>
                                </div>
                                <div class="input-field col s12 m3 l2">
                                    <input  class="right-align" v-model="qtGratuitaPopulacao" ref="populacao" v-on:blur="populacaoValidate(qtGratuitaPopulacao)">
                                    <label class="active" for="qtGratuitaPopulacao">Popula&ccedil;&atilde;o (de {{ (qtExemplares * 0.1) }} at&eacute; {{ (qtGratuitaPopulacaoTotal) }})</label>
                                </div>
                            </div>
                        </div>
                        <!-- Preço popular-->
                        <div class="preco-popular">
                            <div class="row">
                                <div class="input-field col s12 center-align">
                                    <b>Pre&ccedil;o Popular (at&eacute; 20%)</b>
                                </div>
                            </div>
                            <div class="row">
                                <div class="input-field col s6 l2">
                                    <input-money
                                        v-bind:disabled="distribuicaoGratuita=='s' ? true: false"
                                        v-bind:value="vlUnitarioPopularIntegral"
                                        v-on:ev="vlUnitarioPopularIntegral = $event">
                                    </input-money>
                                    <label class="active" for="vlUnitarioPopularIntegral">Pre&ccedil;o Unit&aacute;rio (At&eacute; 50,00)</label>
                                </div>
                                <div class="input-field col s6 l2">
                                    <input  class="right-align" v-model="qtPopularIntegral" ref="qtPopularIntegral">
                                    <label class="active" for="qtPopularIntegral">Qtd. Inteira (At&eacute; {{ qtPrecoPopularValorIntegralLimite }})</label>
                                </div>
                                <div class="input-field col s6 l2">
                                    <input class="right-align" v-model="qtPopularParcial" ref="qtPopularParcial">
                                    <label class="active" for="qtPopularParcial">Qtd. Meia (At&eacute; {{ qtPrecoPopularValorParcialLimite }})</label>
                                </div>
                                <div class="input-field col s6 l2">
                                    <input class="disabled" disabled v-model="vlReceitaPopularIntegral">
                                    <label class="active" for="vlReceitaPopularIntegral">Valor inteira</label>
                                </div>
                                <div class="input-field col s6 l2">
                                    <input class="disabled" disabled v-model="vlReceitaPopularParcial">
                                    <label class="active" for="vlReceitaPopularParcial">Valor meia</label>
                                </div>
                            </div>
                        </div>
                        <div class="proponente-s">
                            <div class="row">
                                <div class="input-field col s12 center-align">
                                    <strong>Proponente (50%)</strong>
                                </div>
                            </div>
                            <div class="row">
                                <div class="input-field col s6 l2">
                                    <input-money
                                        v-bind:disabled="distribuicaoGratuita =='s'? true: false"
                                        v-bind:value="vlUnitarioProponenteIntegral"
                                        v-on:ev="vlUnitarioProponenteIntegral = $event">
                                    </input-money>
                                    <label class="active" for="vlUnitarioProponenteIntegral">Pre&ccedil;o Unitario</label>
                                </div>
                                <div class="input-field col s6 l2">
                                    <input class="disabled" disabled v-model="qtProponenteIntegral">
                                    <label class="active" for="qtProponenteIntegral">Qtd. Inteira</label>
                                </div>
                                <div class="input-field col s6 l2">
                                    <input class="disabled" disabled v-model="qtProponenteParcial">
                                    <label class="active" for="qtProponenteParcial">Qtd. Meia</label>
                                </div>
                                <div class="input-field col s6 l2">
                                    <input class="disabled" disabled v-model="vlReceitaProponenteIntegral">
                                    <label class="active" for="vlReceitaProponenteIntegral">Valor inteira</label>
                                </div>
                                <div class="input-field col s6 l2">
                                    <input class="disabled" disabled v-model="vlReceitaProponenteParcial">
                                    <label class="active" for="vlReceitaProponenteParcial">Valor meia</label>
                                </div>
                            </div>
                        </div>
                        <div class="row receita-prevista center-align">
                            <div class="col s6 l2 offset-l6">
                                <p><strong>Receita Prevista</strong></p>
                            </div>
                            <div class="col s6 l2">
                                {{vlReceitaPrevista}}
                            </div>
                        </div>
                        <div class="row salvar center-align">
                            <br>
                            <br>
                            <button class="btn waves-effect waves-light" ref="add" v-on:click.prevent="salvar">Salvar
                                <i class="material-icons right">send</i>
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</script>
<script type="text/javascript" src="/public/scripts/proposta/plano-distribuicao/detalhar-plano-distribuicao.js"></script>
<style>
    /*#detalhamento-plano table {*/
        /*font-size: 8pt;*/
        /*width: 100%;*/
    /*}*/
    /*#detalhamento-plano button.btn {*/
        /*margin: 1;*/
        /*padding-left: 3px;*/
        /*padding-right: 3px;*/
    /*}*/
    /*#detalhamento-plano button.red {*/
        /*background-color: #c30;*/
    /*}*/
    /*#detalhamento-plano,*/
    /*#detalhamento-plano table,*/
    /*#detalhamento-plano td,*/
    /*#detalhamento-plano th,*/
    /*#detalhamento-plano thead,*/
    /*#detalhamento-plano tbody,*/
    /*#detalhamento-plano tr{*/
        /*padding: 3px;*/
        /*border: 1px solid #666;*/
    /*}*/

    /*#detalhamento-plano table {*/
        /*border-spacing: 1;*/
        /*border-radius: 0px;*/
    /*}*/
</style>
