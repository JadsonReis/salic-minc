<?php if (!empty($this->proposta['idpreprojeto'])) { ?>
    <fieldset>
        <legend class=""> Recurso</legend>
        <form id="form-mensagem"
              method="post"
              action="<?php echo $this->url([
                  'module' => 'recurso',
                  'controller' => 'recurso-proposta',
                  'action' => 'visao-proponente-salvar'
              ]) ?>"
              enctype="multipart/form-data">
            <input type="hidden"
                   name="id_preprojeto"
                   value="<?php echo $this->proposta['idpreprojeto'] ?>"
            />
            <div class="row">
                <div class="col s12">
                    <label class="">
                        Tipo de Solicita&ccedil;&atilde;o <b style="color: red">*</b>
                    </label>
                    <p>
                        <span>
                            <input name="tpSolicitacao"
                                <?php echo (!$this->recursoEnquadramento['tpSolicitacao'] || $this->recursoEnquadramento['tpSolicitacao'] == 'DR') ? "checked='checked'" : '' ?>
                                   type="radio"
                                   value="DR"
                                <?php echo ($this->recursoEnquadramento['stRascunho'] != Recurso_Model_TbRecursoProposta::SITUACAO_RASCUNHO_ENVIADO) ? '' : 'disabled="disabled"' ?>
                                   id="desistencia_prazo_recursal"/>
                            <label for="desistencia_prazo_recursal">Desist&ecirc;ncia do Prazo Recursal</label>
                        </span>
                        <span>
                            <input name="tpSolicitacao"
                                <?php echo ($this->recursoEnquadramento['tpSolicitacao'] && $this->recursoEnquadramento['tpSolicitacao'] == 'EN') ? "checked='checked'" : '' ?>
                                   type="radio"
                                   value="EN"
                                <?php echo ($this->recursoEnquadramento['stRascunho'] != Recurso_Model_TbRecursoProposta::SITUACAO_RASCUNHO_ENVIADO) ? '' : 'disabled="disabled"' ?>
                                   id="recurso"/>
                            <label for="recurso">Recurso</label>
                        </span>
                    </p>
                </div>
            </div>
            <br/>
            <div class="row">
                <div class="col s12">
                    <label class="">
                        Justificativa <b style="color: red">*</b>
                    </label>
                    <p>
                            <textarea cols="80"
                                      id="dsRecursoProponente"
                                      name="dsRecursoProponente"
                                      rows="10"
                                <?php echo ($this->recursoEnquadramento['stRascunho'] != Recurso_Model_TbRecursoProposta::SITUACAO_RASCUNHO_ENVIADO) ? '' : 'disabled="disabled"' ?>
                                      class="textarea_simples"
                                      style="width: 99%"><?php echo $this->recursoEnquadramento['dsRecursoProponente'] ?></textarea>
                    </p>
                </div>
            </div>
            <br/>
            <div class="row">
                <div class="col s12">

                    <p>

                    <ul class="collection">
                        <li class="collection-item ">

                            <?php if (!empty($this->recursoEnquadramento['idArquivo'])
                                && !is_null($this->recursoEnquadramento['idArquivo'])) { ?>
                                <label style="width: 100px; ">Arquivo anexo: </label>
                                <span id="file_name"
                                      style="margin-right:20px"><?= utf8_decode(htmlentities($this->arquivoRecursoProponente['nmArquivo'])); ?></span>

                                <a class="waves-effect waves-light btn tooltipped"
                                   data-position="top"
                                   data-delay="50"
                                   data-tooltip="Download"
                                   target="_blank"
                                   href="<?= $this->url([
                                       'module' => 'default',
                                       'controller' => 'upload',
                                       'action' => 'download-anexo-recurso-proposta'
                                   ],
                                       null,
                                       true); ?>/?id_preprojeto=<?php echo $this->proposta['idpreprojeto'] ?>&idArquivo=<?= $this->arquivoRecursoProponente['idArquivo']; ?>">
                                    <i class="tiny material-icons">file_download</i></a>


                                <a class="waves-effect waves-light btn red darken-4  tooltipped"
                                   data-position="top"
                                   data-delay="50"
                                   data-tooltip="Remover"
                                    <?php echo ($this->recursoEnquadramento['stRascunho'] != Recurso_Model_TbRecursoProposta::SITUACAO_RASCUNHO_ENVIADO) ? '' : 'disabled="disabled"' ?>
                                   href="<?= $this->url([
                                       'module' => 'recurso',
                                       'controller' => 'recurso-proposta',
                                       'action' => 'remover-anexo-proponente'
                                   ],
                                       null,
                                       true); ?>/id_preprojeto/<?php echo $this->proposta['idpreprojeto'] ?>?idArquivo=<?= $this->arquivoRecursoProponente['idArquivo']; ?>">
                                    <i class="tiny material-icons">delete_forever</i>
                                </a>

                            <?php } else { ?>
                                <label>
                                    Anexar Documento :
                                </label>
                                <input type="file"
                                       name="arquivo"
                                       id="arquivo"
                                       class="hiddenfile"/>
                            <?php } ?>
                        </li>
                    </ul>
                    </p>

                </div>
            </div>
            <br/>
            <div class="row">
                <div class="col s12 center">
                    <button class="btn"
                            type="submit"
                            name="acao_salvar"
                        <?php echo ($this->recursoEnquadramento['stRascunho'] != Recurso_Model_TbRecursoProposta::SITUACAO_RASCUNHO_ENVIADO) ? '' : 'disabled="disabled"' ?>
                            value="rascunho">Salvar
                    </button>
                    <button class="btn"
                            type="submit"
                            name="acao_salvar"
                        <?php echo ($this->recursoEnquadramento['stRascunho'] != Recurso_Model_TbRecursoProposta::SITUACAO_RASCUNHO_ENVIADO) ? '' : 'disabled="disabled"' ?>
                            value="enviar">Enviar
                    </button>
                </div>
            </div>
            <script type="text/javascript">
                jQuery(function ($) {

                    var limiteMaximo = 8000
                    var editorRico = $('#dsRecursoProponente').editorRico({
                        altura: 200,
                        isLimitarCarateres: true,
                        maxchar: limiteMaximo,
                        isDesabilitarEdicao: <?php echo ($this->recursoEnquadramento['stRascunho'] != Recurso_Model_TbRecursoProposta::SITUACAO_RASCUNHO_ENVIADO) ? '0' : '1' ?>,
                    })

                    $('#formEnquadramentoProjeto').validate({
                        rules: {
                            dsRecursoProponente: {
                                validarPreenchimento: true,
                                validarPreenchimentoMaximo: true
                            }
                        },

                        messages: {
                            dsRecursoProponente: {
                                validarPreenchimento: 'Dado obrigat&oacute;rio n&atilde;o informado',
                                validarPreenchimentoMaximo: 'limite excedido'
                            }
                        },

                        submitHandler: function (form) {
                            $('#container-progress').show()
                            form.submit()
                        },

                        invalidHandler: function (event, validator) {
                            Materialize.toast(validator.submitted.dsRecursoProponente, 4000)
                        }
                    })

                    $.validator.addMethod('validarPreenchimento', function (value, element) {
                        if (editorRico.contarCaracteres() > 0) {
                            return true
                        }
                    })

                    $.validator.addMethod('validarPreenchimentoMaximo', function (value, element) {
                        if (editorRico.contarCaracteres() <= limiteMaximo) {
                            return true
                        }
                    })
                })
            </script>
        </form>
    </fieldset>
<?php } ?>
