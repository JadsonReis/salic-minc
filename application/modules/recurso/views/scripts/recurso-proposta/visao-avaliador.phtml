<div class="container-fluid">
    <div class="row">
        <div class="page-title">
            <div class="row">
                <div class="col s12 m9 l10">
                    <h1>Avaliar Recurso de Enquadramento da Proposta</h1>
                    <?php
                    $links = [
                        [
                            'Admissibilidade de propostas' => [
                                'module' => 'admissibilidade',
                                'controller' => 'admissibilidade',
                                'action' => 'listar-propostas',
                            ]
                        ],
                        [
                            'An&aacute;lise de Proposta Cultural' => $this->url([
                                    'module' => 'admissibilidade',
                                    'controller' => 'admissibilidade',
                                    'action' => 'exibirpropostacultural',

                                ]) . "?idPreProjeto={$this->proposta['idpreprojeto']}&realizar_analise=sim"
                        ],
                        [
                            'Avaliar Recurso de Enquadramento da Proposta' => [
                                'module' => 'admissibilidade',
                                'controller' => 'admissibilidade',
                                'action' => 'exibirpropostacultural',

                            ]
                        ],
                    ];
                    gerarBreadCrumb($links, 'migalhas');
                    ?>
                </div>
                <div class="col s12 m3 l2 right-align">
                    <?php if (!$this->menu): ?>
                        <a href="javascript:voltar()"
                           title="P&aacute;gina Anterior"
                           class="btn small grey lighten-3 grey-text z-depth-0 chat-toggle">
                            <i class="material-icons">keyboard_return</i>
                        </a>
                    <?php endif ?>
                </div>
            </div>
        </div>
        <div class="content">
            <div class="card-panel">
                <div class="row">
                    <div class="col s12">
                        <?php
                        echo $this->partial("recurso-proposta/inc/bloco_identificacao-proposta-cultural.phtml", $this);
                        ?>
                    </div>
                </div>
                <div class="row">
                    <div class="col s12">
                        <?php
                        echo $this->partial("recurso-proposta/inc/bloco_sugestao-enquadramento.phtml", $this);
                        ?>
                    </div>
                </div>
                <div class="row">
                    <div class="col s12">
                        <p>
                            Tipo de Solicita&ccedil;&atilde;o:
                            <b>
                                <?php
                                $tipoRecurso = "Pedido de Reconsidera&ccedil;&atilde;o";
                                if ($this->recursoEnquadramento['tpRecurso'] == Recurso_Model_TbRecursoProposta::TIPO_RECURSO_RECURSO) {
                                    $tipoRecurso = "recurso";
                                }
                                echo $tipoRecurso; ?>
                            </b>
                        </p>
                    </div>
                </div>
                <div class="row">
                    <div class="col s12">
                        <fieldset>
                            <legend>Justificativa do Pedido</legend>
                            <p class="">
                                <?php echo $this->recursoEnquadramento['dsRecursoProponente'] ?>
                            </p>
                        </fieldset>
                    </div>
                </div>
                <div class="row">
                    <div class="col s12">
                        <p>
                            <?php
                            echo $this->partial("recurso-proposta/inc/bloco_arquivos_anexos.phtml", $this);
                            ?>
                        </p>

                    </div>
                </div>
                <form id="form-mensagem"
                      method="post"
                      action="<?php echo $this->url([
                          'module' => 'recurso',
                          'controller' => 'recurso-proposta',
                          'action' => 'visao-proponente-salvar'
                      ]) ?>"
                      enctype="multipart/form-data">
                    <div class="row">
                        <div class="col s12">
                            <label>Tipo de Avalia&ccedil;&atilde;o</label>
                            <p>
                                <!--                            --><?php //xd($this->recursoEnquadramento); ?>
                                <span>
                            <input name="stAtendimento"
                                <?php echo ($this->recursoEnquadramento['stAtendimento'] == Recurso_Model_TbRecursoProposta::SITUACAO_ATENDIMENTO_SEM_AVALIACAO
                                    || $this->recursoEnquadramento['stAtendimento'] == Recurso_Model_TbRecursoProposta::SITUACAO_ATENDIMENTO_DEFERIDO) ? "checked='checked'" : '' ?>
                                   type="radio"
                                   value="<?php echo Recurso_Model_TbRecursoProposta::SITUACAO_ATENDIMENTO_DEFERIDO ?>"
                                <?php if ($this->recursoEnquadramento['stRascunho'] != Recurso_Model_TbRecursoProposta::SITUACAO_RASCUNHO_ENVIADO
                                    && !is_null($this->recursoEnquadramento['dtAvaliacaoTecnica'])
                                    && !empty($this->recursoEnquadramento['dtAvaliacaoTecnica'])) {
                                    echo 'disabled="disabled"';
                                } ?>
                                   id="situacao_atendimento_deferido"/>
                            <label for="situacao_atendimento_deferido">Deferido</label>
                        </span>
                                <span>
                            <input name="stAtendimento"
                                <?php echo ($this->recursoEnquadramento['stAtendimento']
                                    && $this->recursoEnquadramento['stAtendimento'] == Recurso_Model_TbRecursoProposta::SITUACAO_ATENDIMENTO_INDEFERIDO) ? "checked='checked'" : '' ?>
                                   type="radio"
                                   value="<?php echo Recurso_Model_TbRecursoProposta::SITUACAO_ATENDIMENTO_INDEFERIDO ?>"
                                <?php if ($this->recursoEnquadramento['stRascunho'] != Recurso_Model_TbRecursoProposta::SITUACAO_RASCUNHO_ENVIADO
                                    && !is_null($this->recursoEnquadramento['dtAvaliacaoTecnica'])
                                    && !empty($this->recursoEnquadramento['dtAvaliacaoTecnica'])) {
                                    echo 'disabled="disabled"';
                                } ?>
                                   id="situacao_atendimento_indeferido"/>
                            <label for="situacao_atendimento_indeferido">Indeferido</label>
                        </span>
                            </p>
                        </div>
                    </div>
                    <br/>
                    <div class="row">
                        <div class="col s12">
                            <label>Motiva&ccedil;&atilde;o</label>
                            <p>
                            <textarea cols="80"
                                      id="dsAvaliacaoTecnica"
                                      name="dsAvaliacaoTecnica"
                                      rows="10"
                                <?php if ($this->recursoEnquadramento['stRascunho'] != Recurso_Model_TbRecursoProposta::SITUACAO_RASCUNHO_ENVIADO
                                    && !is_null($this->recursoEnquadramento['dtAvaliacaoTecnica'])
                                    && !empty($this->recursoEnquadramento['dtAvaliacaoTecnica'])) {
                                    echo 'disabled="disabled"';
                                } ?>
                                      class="textarea_simples"
                                      style="width: 99%"><?php echo $this->recursoEnquadramento['dsAvaliacaoTecnica'] ?></textarea>
                            </p>
                        </div>
                    </div>
                    <br/>
                    <div class="row">
                        <div class="col s12 center">
                            <button class="btn"
                                    type="submit"
                                    name="acao_salvar"
                                <?php if ($this->recursoEnquadramento['stRascunho'] != Recurso_Model_TbRecursoProposta::SITUACAO_RASCUNHO_ENVIADO
                                    && !is_null($this->recursoEnquadramento['dtAvaliacaoTecnica'])
                                    && !empty($this->recursoEnquadramento['dtAvaliacaoTecnica'])) {
                                    echo 'disabled="disabled"';
                                } ?>
                                    value="rascunho">Salvar
                            </button>
                            <button class="btn"
                                    type="submit"
                                    name="acao_salvar"
                                <?php if ($this->recursoEnquadramento['stRascunho'] != Recurso_Model_TbRecursoProposta::SITUACAO_RASCUNHO_ENVIADO
                                    && !is_null($this->recursoEnquadramento['dtAvaliacaoTecnica'])
                                    && !empty($this->recursoEnquadramento['dtAvaliacaoTecnica'])) {
                                    echo 'disabled="disabled"';
                                } ?>
                                    value="enviar">Enviar
                            </button>
                        </div>
                    </div>
                    <script type="text/javascript">
                        jQuery(function ($) {

                            var limiteMaximo = 8000
                            var editorRico = $('#dsAvaliacaoTecnica').editorRico({
                                altura: 200,
                                isLimitarCarateres: true,
                                maxchar: limiteMaximo,
                                isDesabilitarEdicao: <?php echo ($this->recursoEnquadramento['stRascunho'] != Recurso_Model_TbRecursoProposta::SITUACAO_RASCUNHO_ENVIADO) ? '0' : '1' ?>,
                            })

                            $('#formEnquadramentoProjeto').validate({
                                rules: {
                                    dsAvaliacaoTecnica: {
                                        validarPreenchimento: true,
                                        validarPreenchimentoMaximo: true
                                    }
                                },

                                messages: {
                                    dsAvaliacaoTecnica: {
                                        validarPreenchimento: 'Dado obrigat&oacute;rio n&atilde;o informado',
                                        validarPreenchimentoMaximo: 'limite excedido'
                                    }
                                },

                                submitHandler: function (form) {
                                    $('#container-progress').show()
                                    form.submit()
                                },

                                invalidHandler: function (event, validator) {
                                    Materialize.toast(validator.submitted.dsAvaliacaoTecnica, 4000)
                                }
                            })

                            $.validator.addMethod('validarPreenchimento', function (value, element) {
                                if (editorRico.contarCaracteres() > 0) {
                                    return true
                                }
                            })

                            $.validator.addMethod('validarPreenchimentoMaximo', function (value, element) {
                                if (editorRico.contarCaracteres() <= limiteMaximo) {
                                    return true
                                }
                            })
                        })
                    </script>
                </form>
            </div>
        </div>
    </div>
</div>
