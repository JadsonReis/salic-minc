<li id="btn-solicitacoes" class="btn-notificacao" style="position: relative">
    <a class="white-text tooltipped" data-activates="header_notificacoes"
       data-position="left"
       data-delay="50"
       data-tooltip="Ir para Notifica&ccedil;&otilde;es" href="javascript:void(0)"
       data-ajax-render='/solicitacao/mensagem/listar-ajax<?= $this->params; ?>'
       data-ajax-target='#header_notificacoes'
    >
        <i class="material-icons left">notifications</i>
    </a>
    <div id="header_notificacoes" class="dropdown-content dropdown-media active black-text" style="opacity: 1"></div>
</li>

<script>
    // quando clicar fora do elemento fechar os icones
    $3(document).on("click", function (e) {
        if (!$3(e.target).closest('#header_notificacoes').length) {
            if ($3('#header_notificacoes').is(":visible")) {
                $3('#header_notificacoes').hide();
            }
        }

    });

    $3(document).ready(function () {
        contarSolicitacoesNaoLidas();
    });

    function contarSolicitacoesNaoLidas() {
        $3.ajax({
            type: "post",
            url: "<?php echo $this->url(array('module' => 'solicitacao', 'controller' => 'mensagem', 'action' => 'contar-solicitacoes-nao-lidas-ajax'), null, true); ?>",
            success: function (data) {
                if (data.status == true && data.msg > 0) {
                    $3("#btn-solicitacoes a").append('<span class="btn-floating waves-effect waves-light orange darken-1">' + data.msg + '</span>');
                }
            },
            dataType: 'json'
        });
    }
</script>

